<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
    <title>Read ID</title>

    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
    <link rel="stylesheet" type="text/css" href="../css/marker-style.css">
</head>
<body>
    <!-- Top Bar -->
    <div id="top-bar">
        <div class="text" id="text-result">Set the minimum and maximum distances for the markers first!</div>
        <input type="number" id="min" placeholder="min">
        <input type="number" id="max" placeholder="max">
        <button onclick="btnSet()">Set</button>
        <button class="left" onclick="btnReset()">Reset</button>
        <button class="red" onclick="btnClose()">Close</button>
    </div>

    <!-- Scanner -->
    <div class="scanner" id="scanner1"></div>
    <div class="scanner" id="scanner2"></div>

    <script src="../js/MultitouchMarker-3.1.js"></script>
    
    <script>

        /////////////////////////////////////////////////////////////////////
        //                     Scanner Initialization                      //
        /////////////////////////////////////////////////////////////////////

        // Scanner 1
        const scanner1 = new Scanner({
            element: "scanner1",
            text: "Check Min or Max distance",
            posX: "34vw",
            posY: "20vh",
            // width: "38vw",
            // height: "38vw",
            // rotate: "5deg",
            // bgColor: "#f5720055",
            // bgImage: "url(../images/bgScanner.png)",
            // bgActive: "url(../images/bgActive.png)",
            // devMode: true,
        });

        // Scanner 2
        const scanner2 = new Scanner({
            element: "scanner2",
            posX: "30vw",
            posY: "50vh",
            width: "40vw",
            height: "40vw",
            // rotate: "5deg",
            bgColor: "#f5720055",
            bgImage: "url(../images/bgScanner.png)",
            bgActive: "url(../images/bgActive.png)",
            text: "Check the Marker ID",
            // showResult: true,
            showDot: true,
            dotColor: "#4771ed",
        });

        // ID Setup
        scanner2.setId({
            minDistance: 70,
            maxDistance: 140,
        });


        /////////////////////////////////////////////////////////////////////
        //                        Read Every Frame                         //
        /////////////////////////////////////////////////////////////////////
        
        const textResult = document.getElementById("text-result");
        let scanResult = {};

        let nData = 0;
        let totalMin = 0;
        let totalMax = 0;

        function frameLoop() {
            if (scanner1.getData(scanResult)) {
                nData += 1;
                totalMin += scanResult.minDistance;
                totalMax += scanResult.maxDistance;

                textResult.textContent = `N Data: ${nData} `;
                textResult.textContent += `| Min: ${(totalMin / nData).toFixed(2)} `;
                textResult.textContent += `| Max: ${(totalMax / nData).toFixed(2)}`;
            }
            else if (scanner2.getData(scanResult)) {
                textResult.textContent = `Marker ID: ${scanResult.id} `;
                textResult.textContent += `| Min: ${scanResult.minDistance} `;
                textResult.textContent += `| Max: ${scanResult.maxDistance}`;
                textResult.textContent += `| Deg: ${Math.round(scanResult.degrees)}`;



                // textResult.textContent = `Marker ID: ${scanResult.id} | Touches: ${scanResult.numOfTouch} | Distance: ${scanResult.distance}`;
            }

            requestAnimationFrame(() => {
                frameLoop();
            });
        }

        frameLoop();


        /////////////////////////////////////////////////////////////////////
        //                        Button Functions                         //
        /////////////////////////////////////////////////////////////////////

        function btnReset() {
            window.location.reload();
        }

        function btnClose() {
            window.location.href = "../index.html";
        }

        function btnSet() {
            const min = parseInt(document.getElementById("min").value);
            const max = parseInt(document.getElementById("max").value);

            if (!isNaN(min) && !isNaN(max)) {
                scanner2.setId({
                    minDistance: min,
                    maxDistance: max,
                });

                textResult.textContent = "Minimum and Maximum distances Saved!"
            }
        }

    </script>
</body>
</html>